# Transcriber
着眼于对文档文件音视频和pdf的粗浅处理。

## 一、项目亮点 / 特性  

- 🚀 **离线安全**：本地运行，无使用频率限制，不联网、不收集数据，保护隐私；  
- 📄 **多功能支持**：  
  - 音视频处理：声音转文字、视频字幕、提取音频、视频转GIF、压缩视频、调整视频尺寸、裁剪视频、视频加水印、转帧、音视频合流等；  
  - 文档处理：PDF加水印、提取PDF文字、文档压缩等；  
  - 图片处理：图片转PDF、图片识字、按比例裁图、图片格式转换等；  
  - 其他工具：词云生成、文件加密、文件排序等；
  - 同时尽量避免与专业图形化操作软件生态位重叠以减少重复造轮子，是「电脑小白与专业人士之间的桥梁」；  
- ⚡ **高效处理**：  
  1. 多进程并行：可同时打开多个功能窗口，并行处理多项任务；  
  2. 硬件加速：兼容时GPU处理（OpenCL/CUDA），提升数据处理效率；  
  3. 算法优化：部分功能（如文件加密）通过GPU加速和算法优化，处理效率显著提升（例如1.42GB数据仅需0.23秒）。  


## 二、安装指南  

### 1. 环境要求  
- 操作系统：Windows 10/11（64位），Win7可能报错，其他平台未测试；  
- **快速启动**：  
  直接下载打包好的exe文件：  
  - 百度网盘：[链接]  
  - OneDrive：[链接]  
  下载后解压缩，双击 `EasyTranscriber.exe` 即可运行。  
- **源码运行**：  
  - 依赖：Python 3.13.3（64位）、依赖库详见 `requirements.txt`。  

### 2. 安装步骤（源码运行）  
```bash
# 克隆仓库
git clone https://github.com/Easy-0-1/Transcriber.git
cd Transcriber

# 安装模型和ffmpeg（按需选择）
# 【若无需语音转文字/视频处理功能，可跳过此步，视频加字幕功能不受影响】
# 替换以下文件为官网下载的实际文件：
# - fff/ffmpeg-2025-07-23-git-829680f96a-full_build.txt
# - fff/recognise/small.txt、medium.txt（whisper模型）
#（whisper模型可以根据实际需求下载其他体量的模型，此时只需更改abstrac_trvoice和#Ui_mode有关参数即可。）
#此外，whisper模型可以动态加载（使用load()函数），这里储存在本地是为了避免用户在#运行时等待时间过长或下载失败。

# 安装依赖
pip install -r requirements.txt

# 运行项目
python head.py
```  


### 3. 常见问题  
1. 运行时闪退：检查Python版本是否符合要求，检查输入和操作是否合法；  
2. `whisper\\assets`有关文件导入错误：需将 `site-packages\\whisper\\assets` 显式添加到 `.spec` 文件的 `datas` 列表；  
3. `load_model()` 本地加载报错，说torch.__version__ >= "1.13"时"weights_only":打开 `whisper\__init__.py`，将第150行 `{"weights_only": True}` 改为 `{"weights_only": False}`（VSCode中按住CTRL点击函数可快速访问）；  
4. 加密文件内存过载：减少分块大小和工作组规模；  
5. `fff`/`wordcloud` 等边报错边运行：有正确结果即可，详见代码注释。  


## 三、使用提示【重要】  

1. **音视频相关功能**（如压缩视频、声音转文字等）运行时会打开黑色窗口，用于输出处理过程细节、进度和结果，关闭窗口将终止任务；  
2. **输出路径**：  
   - 词云生成、图片转PDF的结果保存在桌面；  
   - 其他功能结果保存在原文件目录，以 `output` 或类似后缀命名，建议及时重命名避免被覆盖；  
   - 无文件输出的功能（如声音转文字等），结果将在黑色窗口显示。  
3. **词云生成**：手轮顺时针增大参数、逆时针减小，右下方为最大值，左下方为最小值，转多圈没有实际意义；结果需用浏览器打开，一些基础轮廓如长方形，刷新可变换排布样式，欲保存截图即可。  
4. **图片转换**：部分格式转换可能有兼容问题，如psd→png通道偏移、png→jpg发生透明背景变黑或变白。请先确认原格式是否可以向目标格式转换，如果转换失败，程序可能停止工作，但这不会对电脑或程序本身带来任何损害。另外，如果没有特定要求或不用透明背景，将png-->jpg可在肉眼看不出差别的效果下显著减少储存空间占用。 
5. **图片转PDF**：支持拖入图片或含图片的文件夹，转换失败可先将图片转为jpg格式。  
6. **PDF转文字**：结果生成 `.doc` 文件，用Word打开时选择UTF-8编码。用.doc是因为.docx不能直接写入，而.txt在编辑排版等方面不太灵活。对于单个文件，可手动另存为 `.docx`格式。  
7. **声音转文字**：不止限于音频文件，视频文件如.mp4也可以直接处理。
如果有报错信息_pickle.UnpicklingError，请往上翻看看有没有正确结果。有时候它做完了还要嚷嚷几下，具体原因有待分析。
release中提供了small和medium模型以在时间、占用空间和准确率之间作出平衡，实际上whisper还有更准确或更快的模型，可以按照三、2.所述进行配置。
8. **PDF加水印**：原作者设置权限的情况下可能无法执行操作。  
9. **文件排序**：文件排序前后缀均指文件扩展名以前的部分（普通用户批量改扩展名不熟悉也不常用，故未处理），
输出为前缀+序号+后缀+扩展（若开了扩展显示），这里前缀、后缀两者或任一均可不填，从而输出序号+扩展，前缀+序号+扩展，序号+后缀+扩展等格式；
排序依据是拖入文件的顺序（选取文件、文件夹窗口的列表里文件顺序）；
不要输入重命名时不允许的字符，如分隔符等。
10. **视频字幕**：输出为无声音视频，因为添加声音在常见剪辑软件均可解决（简单地，把有声音的视频放到下层轨道并打开声音即可），也可通过「提取音频」和「音视频合流」功能补加声音。  
11. **文档压缩**：原理是将`.doc.ppt.xls.wps`的文档转为`.docx.pptx.xlsx`。
理由是收到的.doc.ppt.xls.wps多为学习资料等不上台展示，不在乎细微排版变化的文档，在忽略细微的兼容差异下，这种转换可以显著降低储存空间占用（原格式直接储存为二进制，新格式先压缩后储存）。具体来说，除了一些旧版的罕见字体会被替换成系统默认字体，旧版嵌入符号替换为不可编辑图片（仍可转换为新版字符后编辑）等，原始信息不会被减损。
然而一个个文档打开再点击另存为比较麻烦，该功能可以自动递归遍历文件夹及子文件夹的`.doc.ppt.xls.wps`文档，并批量转换成`.docx.pptx.xlsx`文档。
为了安全，验证输出结果后原文件需手动删除。
 
12. **图片识字**：release中考虑到使用频率和内存占用，已根据paddleOCR的README文件提示把除了中文和英语以外的文件删除，但实际上paddleOCR可以支持丰富的多语言识别，有经验的用户可以自行配置，只需把`PaddleOCR-json_v1.4.1_windows_x64/ models`替换即可。

13.由于语言限制，软件启动时可能需要稍事等待。


## 四、项目结构  

```plaintext
Transcriber/
├── core/                         # 核心程序
│   ├── EasyTranscriber.py        # 程序入口与启动动画
│   ├── cy.py                     # 词云生成模块
│   ├── doc_to_docx.py            # 文档压缩模块
│   ├── ffmpeeg.py                # fff.exe调用模块
│   ├── jpg_to_pdf.py             # 图片转PDF
│   ├── pdf.py                    # PDF加水印、转文字
│   ├── png_to_jpg.py             # 图片格式转换
│   ├── pxmm.py                   # 文件排序命名
│   ├── spzm1.py                  # 视频字幕
│   ├── tpbl.py                   # 按比例裁图
│   ├──Ui_cutpi.py			          #按比例裁图UI
│   ├──Ui_cutvdo.py				        #裁视频UI
│   ├──Ui_fps.py					        #转帧UI
│   ├──ui_frontbebind.py		      #文件排序UI
│   ├──Ui_gif.py					        #视频转gifUI
│   ├──Ui_key.py					        #文件加密UI
│   ├──Ui_markrotatetrainkle.py	  #pdf加水印UI
│   ├──Ui_mode.py				          #声音转文字UI
│   ├──Ui_piform.py				        #图片转换UI
│   ├──Ui_tiaoz.py				        #调整视频尺寸UI
│   ├──Ui_viwtmk.py				        #视频加水印UI
│   ├──Ui_wd.py					          #词云UI
│   ├──Ui_zim.py				        	#视频加字幕UI
│   ├──UI004.py                  # 综合UI，综合函数调用，多进程启动
│   ├──aes256split.py            # 文件加密
│   ├──setup.py                  # 将除了head.py以外的.py文件编译为.pyd文件（需通过终端启动）
│   ├──myapp.spec                # pyinstaller打包配置
│   ├──OCR/                      # OCR相关程序
│   │   ├── PaddleOCR-json_v1.4.1_windows_x64/  # OCR核心程序
│   │   └── PaddleOCR-json-main/
│   │   			├──LICENSE   
│   │   			├──…………				
│   │    			└──demo3.py		      # 图片转文字模块（调用接口）
│   └── pictures/                 # 图标及UI图片
│
├── fff/                          # 音视频处理依赖（单独打包免启动速度过慢）
│   ├── ffmpeg-2025-07-23-git-829680f96a-full_build.txt           # 需替换为实际ffmpeg文件
│   ├── recognise/
│   │   ├── medium.txt            # 需替换为实际.pt模型
│   │   └── small.txt
│   ├── abstract_voice.py         # 声音转文字
│   ├── fff.py                    # 指令解析与分发
│   ├── ffmpegg.py                # 调用与功能执行
│   ├── in.ico                    # 程序图标
│   ├── myapp.spec                # pyinstaller打包配置
│   └── setup.py                  # 编译优化
│
├── DISCLAIMER                    # 免责声明
├── requirements.txt              # 依赖列表
├── LICENSE                       # 许可证
└── NOTICE                        # 版权声明
```  

> 注：UI与执行文件放在同一目录是因为跨文件夹导入需使用额外的模块，增加可以避免的开销；
> 为减少体积，部分依赖以.txt占位，需到官网或原仓库下载实际文件替换。  


## 五、技术栈与实现细节  

1. 界面框架：PyQt6；  
2. OCR引擎：PaddleOCR（轻量级模型，本地部署速度快）；  
3. 图像处理：Pillow格式转换；  
4. 性能优化：多进程批量处理文件,避免界面卡顿；  
5. 文件加密：python在数据分析中越来越广泛的使用，使得探索利用python调用GPU并行处理数据，进一步提高python速度上限具有重要意义。T表加速和ctr模式处理AES加密见于多篇文献和毕业设计，但是结合到python的例子尚未在网上和文献库找到。本文件加密功能模仿AES256加密方法，在numpy等库的使用，分块处理数据，查表法，索引数据集合储存，数据向量化，流水线技术，循环展开等不一而足，使得原本需0.2秒（众数）加密的数据仅需0.006秒（众数）即可完成；1.42GB的数据0.23秒即可加速完成（测试调用rtx4060，不包括外层函数处理时间，详见源代码)，密钥采用字符串转码生成，简便易记且组合丰富。

## 六、致谢与参考  

### 致谢  
- 项目贡献者：诚挚感谢等差数列（详细指导了内核代码中的指针、竞态条件问题）、声声慢（为UI设计提供建议）、赤鸡仙人（为软件功能规划提供建议）；  
- 技术支持社区：非常感谢博客园、CSDN、腾讯云开发者社区、思否、知乎、简书等；  
- AI工具：特别感谢AI豆包不厌其烦地解答开发过程中遇到的无数琐碎或艰难的问题，以及提供第三方库和模型的对比分析和选择建议，AIDeepSeek对内核代码优化的细致分析，AI文心一言对ASE加密过程中T表，轮密钥生成等概念的阐述； 
- 同时感谢所有乐于分享知识和自己的见解，善于解答他人疑惑的人，没有他们就没有这个项目。  

### 参考资源  
- 教程：B站白月黑羽QtDesigner教程；  
- 开源项目：[武汉大学密码学大作业——利用GPU加速aes算法](https://github.com/moep0/aes_gpu)；  
- 文献：  
  [1] 蒲金伟, 郑欣, 徐迎晖. AES抗差分功耗分析高效门限实现[J]. 小型微型计算机系统, 2024, 10:2522-2528.  
  [2] 白茹雪, 刘鸿雁, 张新贺. 基于ARM920T的AES算法实现方案[J]. 计算机应用, 2011, 31(5):1295-1301.  
  [3] 高级加密标准AES-FIPS197中文版. [链接](http://www.masol7.com/wp-content/uploads/2023/03/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86AES-FIPS197%E4%B8%AD%E6%96%87%E7%89%88.pdf)  


## 七、贡献指南  

- **提交Bug**：在Issues按模板填写「复现步骤 + 系统环境 + 错误日志」；  
- **开发规范**：遵循PEP 8风格，新增功能需附带单元测试；  
- **PR流程**：Fork仓库→创建分支（`feature/bugfix/xxx`）→提交代码→发起PR。  


## 八、许可证与免责声明  

- 本项目开源许可证：[木兰宽松许可证第2版](LICENSE.txt)；  
- 第三方库版权信息详见[NOTICE](NOTICE.txt)；  
- 使用前请阅读[免责声明](DISCLAIMER.txt)，了解风险提示。  


## 九、联系方式与反馈  

- 项目地址：[https://github.com/Easy-0-1/Transcriber](https://github.com/Easy-0-1/Transcriber)；  
- 问题交流：GitHub Discussions板块。  


## 十、其他  
### 1. 创作动机  
函数的功能就是把常用的代码集中起来，要的时候直接调用即可，本软件的目的也类似。我的好多同学问我一些问题，如图片怎么按比例裁剪，视频怎么转帧，我都知道可以通过代码实现，但是我直接把代码发过去他们用不了，并且别人的路终究要别人去走，我不可能对每一个事项都写一篇代码。我得知同学的需求在那里，同时也想把刚学的python应用到生活实际中去解决具体问题，便想做一个实用的工具出来。
### 2. 定位  
必须承认，本软件没有任何不可替代之处，亦没有任何值得称道的创新和发现，如果是计算机专业的学生可能三天就能完成我一个月的工作。尽管如此，它涵盖了诸多常用功能，即使都用不上，初学者参考有关代码也可能对python学习有些微帮助。
### 3. 待优化方向  
软件在制作过程中，时刻不忘对便捷迅速简单的追求，并尝试了如项目亮点所说的多种优化方案。但是由于自身所学有限，软件存在函数调用过程繁琐、UI界面风格不统一（用qtmaterial会改字体大小）、函数和类嵌套关系复杂等问题需要进一步优化。此外，将调整字体大小应用到全局、减少判断分支等也是值得优化的地方；由于对pyqt的不熟，很多参数可以让用户自行调整的没有做到，像jpg图像质量，ffmpeg的各种参数等；另外一些库的功能只发挥了冰山一角，如ffmpeg丰富的滤镜等；软件的完成和异常也没有完善的提示（因为QMessage要新建应用实例，当前逻辑下会过于冗长）。
### 4. 结语  
本项目时间紧（要在朋友生日前完成），内外压力大（父母为这个已经对我失去了耐心），任务艰巨（七月底我朋友让我引入ffmpeg），基础薄弱（只选学了一年python，专业与计算机无关），能走到现在全得益于网上丰富的资料，再次感谢所有乐于分享知识和自己的见解，善于解答他人疑惑的人。欢迎提出改进建议，共同完善工具实用性。  
